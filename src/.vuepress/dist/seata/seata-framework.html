<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.38" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/seata/seata-framework.html"><meta property="og:site_name" content="Java八股文网"><meta property="og:description" content="深度解析Seata：微服务分布式事务的破局之道 随着微服务架构的广泛应用，业务系统被拆分成更小、独立的单元，它们各自拥有自己的数据库。这带来了巨大的灵活性和可伸缩性，但也引入了一个棘手的难题：分布式事务。当一个业务操作需要跨越多个服务、访问多个数据库时，如何保证这些操作的原子性（要么全部成功，要么全部失败）？这就是分布式事务需要解决的核心问题。 1. ..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-02T16:02:07.000Z"><meta property="article:author" content="Mr.Hope"><meta property="article:modified_time" content="2025-05-02T16:02:07.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"","image":[""],"dateModified":"2025-05-02T16:02:07.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><title>Java八股文网</title><meta name="description" content="深度解析Seata：微服务分布式事务的破局之道 随着微服务架构的广泛应用，业务系统被拆分成更小、独立的单元，它们各自拥有自己的数据库。这带来了巨大的灵活性和可伸缩性，但也引入了一个棘手的难题：分布式事务。当一个业务操作需要跨越多个服务、访问多个数据库时，如何保证这些操作的原子性（要么全部成功，要么全部失败）？这就是分布式事务需要解决的核心问题。 1. ...">
    <link rel="preload" href="/assets/style-CU64CyBi.css" as="style"><link rel="stylesheet" href="/assets/style-CU64CyBi.css">
    <link rel="modulepreload" href="/assets/app-BwInYlua.js"><link rel="modulepreload" href="/assets/seata-framework.html-5t3SR2wD.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DBB9Jmv1.js" as="script"><link rel="prefetch" href="/assets/README2.html-GnFM14wE.js" as="script"><link rel="prefetch" href="/assets/README3.html-BB9MF91Y.js" as="script"><link rel="prefetch" href="/assets/home.html-QkrduVid.js" as="script"><link rel="prefetch" href="/assets/home2.html-CFgjydIg.js" as="script"><link rel="prefetch" href="/assets/updating.html-_rYCTmYk.js" as="script"><link rel="prefetch" href="/assets/about-me.html-Nj-aOLWx.js" as="script"><link rel="prefetch" href="/assets/index.html-IeECesvm.js" as="script"><link rel="prefetch" href="/assets/algo-array.html-BvckUfhy.js" as="script"><link rel="prefetch" href="/assets/algo-listnode.html-Cr6UOAhU.js" as="script"><link rel="prefetch" href="/assets/algo-other.html-Azlbzz0x.js" as="script"><link rel="prefetch" href="/assets/algo-sort.html-BZkVocSk.js" as="script"><link rel="prefetch" href="/assets/algo-string.html-CE3THRND.js" as="script"><link rel="prefetch" href="/assets/algo-tree.html-CzAaHDZf.js" as="script"><link rel="prefetch" href="/assets/brain.html-WELC4t8Y.js" as="script"><link rel="prefetch" href="/assets/annotation.html-DUWGvl2w.js" as="script"><link rel="prefetch" href="/assets/copy.html-ByVMeuSb.js" as="script"><link rel="prefetch" href="/assets/delivery.html-B5iNACeM.js" as="script"><link rel="prefetch" href="/assets/exception.html-DBRllOiG.js" as="script"><link rel="prefetch" href="/assets/generic.html-CCNaVP5Z.js" as="script"><link rel="prefetch" href="/assets/java8.html-B3Alq3QD.js" as="script"><link rel="prefetch" href="/assets/proxy.html-yV2Tg5rR.js" as="script"><link rel="prefetch" href="/assets/reflect.html-CZtBOtpd.js" as="script"><link rel="prefetch" href="/assets/index.html-CqDKuTMQ.js" as="script"><link rel="prefetch" href="/assets/disable.html-CxbtxiU4.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-CJmXt2_e.js" as="script"><link rel="prefetch" href="/assets/layout.html-BVG-upV-.js" as="script"><link rel="prefetch" href="/assets/markdown.html-DqrCUE4A.js" as="script"><link rel="prefetch" href="/assets/page.html-ByqUkzvh.js" as="script"><link rel="prefetch" href="/assets/AQS.html-CyFh2vag.js" as="script"><link rel="prefetch" href="/assets/AtomicInteger.html-C-byl_57.js" as="script"><link rel="prefetch" href="/assets/CountDownLatch.html-BpnakxuL.js" as="script"><link rel="prefetch" href="/assets/CyclicBarrier.html-BZ8c014y.js" as="script"><link rel="prefetch" href="/assets/ReentrantLock.html-DbkHrQw0.js" as="script"><link rel="prefetch" href="/assets/Semaphore.html-CUbsQT47.js" as="script"><link rel="prefetch" href="/assets/Synchronized.html-CAAxwsnW.js" as="script"><link rel="prefetch" href="/assets/Thread.html-CurxEKj0.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal.html-BZ-n2MVe.js" as="script"><link rel="prefetch" href="/assets/ThreadPool.html-Cu2_xFpZ.js" as="script"><link rel="prefetch" href="/assets/volatile.html-CqfxthdA.js" as="script"><link rel="prefetch" href="/assets/ddd-framework.html-DW0LVLcB.js" as="script"><link rel="prefetch" href="/assets/场景题.html-BxlBgUAR.js" as="script"><link rel="prefetch" href="/assets/disruptor-framework.html-CFQYZX2_.js" as="script"><link rel="prefetch" href="/assets/dubbo-framework.html-C7LPqfR9.js" as="script"><link rel="prefetch" href="/assets/elasticsearch-framework.html-Bwpt0FFg.js" as="script"><link rel="prefetch" href="/assets/elasticsearch-select.html-BZIkR_zi.js" as="script"><link rel="prefetch" href="/assets/eq-student.html-1Xsi3Hsg.js" as="script"><link rel="prefetch" href="/assets/manager.html-Csq5f8vR.js" as="script"><link rel="prefetch" href="/assets/summary.html-TK10dBrq.js" as="script"><link rel="prefetch" href="/assets/upgrade.html-B-y8ycw5.js" as="script"><link rel="prefetch" href="/assets/grpc-framework.html-DX-WtjcN.js" as="script"><link rel="prefetch" href="/assets/index.html-K7jPTZOM.js" as="script"><link rel="prefetch" href="/assets/index.html-CLolR4x5.js" as="script"><link rel="prefetch" href="/assets/flow.html-LhEKVEz4.js" as="script"><link rel="prefetch" href="/assets/profile.html-Cb7l-Jkw.js" as="script"><link rel="prefetch" href="/assets/project.html-CWq6TC8V.js" as="script"><link rel="prefetch" href="/assets/question.html-CE3LX8sp.js" as="script"><link rel="prefetch" href="/assets/salary.html-B5MAY2w8.js" as="script"><link rel="prefetch" href="/assets/work-question.html-CwQ_1eHc.js" as="script"><link rel="prefetch" href="/assets/jvm-framework.html-BcuNGigG.js" as="script"><link rel="prefetch" href="/assets/jvm-optimize.html-BoqcPl_E.js" as="script"><link rel="prefetch" href="/assets/mybatis-framework.html-6vDyjUgk.js" as="script"><link rel="prefetch" href="/assets/MySQL链路追踪.html-Ge35CMoQ.js" as="script"><link rel="prefetch" href="/assets/backup.html-CfjVQXu0.js" as="script"><link rel="prefetch" href="/assets/dead.html-BxtIMGJh.js" as="script"><link rel="prefetch" href="/assets/engine.html-BvSMBPfH.js" as="script"><link rel="prefetch" href="/assets/explain.html-DyW4N3jT.js" as="script"><link rel="prefetch" href="/assets/framework.html-B73LGr3O.js" as="script"><link rel="prefetch" href="/assets/index.html-5ECHEQdT.js" as="script"><link rel="prefetch" href="/assets/lock.html-DS22dKbr.js" as="script"><link rel="prefetch" href="/assets/log.html-BhXRYpRi.js" as="script"><link rel="prefetch" href="/assets/MVCC.html-DMOcBJZ-.js" as="script"><link rel="prefetch" href="/assets/online.html-DMNbTMN2.js" as="script"><link rel="prefetch" href="/assets/optimize.html-DJgdKvQB.js" as="script"><link rel="prefetch" href="/assets/page.html-BOIfIFoT.js" as="script"><link rel="prefetch" href="/assets/performance.html-C4OzjcAN.js" as="script"><link rel="prefetch" href="/assets/phantom.html-DCOWz150.js" as="script"><link rel="prefetch" href="/assets/push.html-CVBLR7C5.js" as="script"><link rel="prefetch" href="/assets/range.html-BHaT9mDy.js" as="script"><link rel="prefetch" href="/assets/second.html-DN3d5wcC.js" as="script"><link rel="prefetch" href="/assets/skip.html-B7fm4onR.js" as="script"><link rel="prefetch" href="/assets/slow.html-eCYUoqfF.js" as="script"><link rel="prefetch" href="/assets/standard.html-qOUYnAff.js" as="script"><link rel="prefetch" href="/assets/sync.html-CTNG4veV.js" as="script"><link rel="prefetch" href="/assets/three.html-DWtI3qI6.js" as="script"><link rel="prefetch" href="/assets/timeout.html-DR-eDBMc.js" as="script"><link rel="prefetch" href="/assets/transaction.html-C0ToRNFk.js" as="script"><link rel="prefetch" href="/assets/ArrayBlockingQueue.html-Bu3N105Y.js" as="script"><link rel="prefetch" href="/assets/ArrayList.html-8HrPAWpO.js" as="script"><link rel="prefetch" href="/assets/BlockingQueue合集.html-CpCkLaT1.js" as="script"><link rel="prefetch" href="/assets/ConcurrentHashMap.html-pb-lQNzQ.js" as="script"><link rel="prefetch" href="/assets/CopyOnWriteArrayList.html-DOGb0EnI.js" as="script"><link rel="prefetch" href="/assets/DelayQueue.html-CgptiiKx.js" as="script"><link rel="prefetch" href="/assets/HashMap.html-BKi-xf8i.js" as="script"><link rel="prefetch" href="/assets/LinkedBlockingQueue.html-DzhP_OaV.js" as="script"><link rel="prefetch" href="/assets/LinkedHashMap.html-CcTWPj9e.js" as="script"><link rel="prefetch" href="/assets/LinkedList.html-BcnKsoB4.js" as="script"><link rel="prefetch" href="/assets/PriorityQueue.html-BzHvhvNH.js" as="script"><link rel="prefetch" href="/assets/Set.html-DmvJcP6i.js" as="script"><link rel="prefetch" href="/assets/SynchronousQueue.html-BgfS3aPO.js" as="script"><link rel="prefetch" href="/assets/TreeMap.html-DL_7-6Mo.js" as="script"><link rel="prefetch" href="/assets/netty-framework.html-BbWcr3H5.js" as="script"><link rel="prefetch" href="/assets/pulsar-framework.html-DhKRv_Sl.js" as="script"><link rel="prefetch" href="/assets/pulsar-user.html-B8kKBN99.js" as="script"><link rel="prefetch" href="/assets/nacos-framework.html-CgfgXcNT.js" as="script"><link rel="prefetch" href="/assets/redis-batch.html-CW2vSkC-.js" as="script"><link rel="prefetch" href="/assets/redis-bigkey.html-BkmaE7TQ.js" as="script"><link rel="prefetch" href="/assets/redis-cache.html-Dnj_TJWO.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-tCePRVZk.js" as="script"><link rel="prefetch" href="/assets/redis-data.html-CI9XAvPM.js" as="script"><link rel="prefetch" href="/assets/redis-fast.html-X3Nvey1L.js" as="script"><link rel="prefetch" href="/assets/redis-hotkey.html-IqnqKGPP.js" as="script"><link rel="prefetch" href="/assets/redis-lock.html-ChoA-amD.js" as="script"><link rel="prefetch" href="/assets/redis-mq.html-B7m1aWDc.js" as="script"><link rel="prefetch" href="/assets/redis-persistent.html-BsKZOfEP.js" as="script"><link rel="prefetch" href="/assets/redis-thread.html-Bx_w3mQ7.js" as="script"><link rel="prefetch" href="/assets/redis-transaction.html-DrbX8COX.js" as="script"><link rel="prefetch" href="/assets/springboot-annotation.html-DK8VwPZM.js" as="script"><link rel="prefetch" href="/assets/springboot-start.html-CRAqvOCY.js" as="script"><link rel="prefetch" href="/assets/springboot-starter.html-CrtJ6cG5.js" as="script"><link rel="prefetch" href="/assets/springboot-what.html-DpDSgat_.js" as="script"><link rel="prefetch" href="/assets/spring-annotation.html-DXPv97B2.js" as="script"><link rel="prefetch" href="/assets/spring-bean.html-0fU_b6wd.js" as="script"><link rel="prefetch" href="/assets/spring-depend.html-B6gVnLsy.js" as="script"><link rel="prefetch" href="/assets/spring-design.html-DoexNcl7.js" as="script"><link rel="prefetch" href="/assets/spring-framework.html-Bksp8Pdp.js" as="script"><link rel="prefetch" href="/assets/spring-ioc-aop.html-yqSPLJDG.js" as="script"><link rel="prefetch" href="/assets/spring-transaction.html-qXV2W3LA.js" as="script"><link rel="prefetch" href="/assets/springcloud-eureka.html-drziIQos.js" as="script"><link rel="prefetch" href="/assets/springcloud-feign.html-CN3fVr21.js" as="script"><link rel="prefetch" href="/assets/springcloud-framework.html-B4az6GdD.js" as="script"><link rel="prefetch" href="/assets/springcloud-gateway.html-BCnzJ2XB.js" as="script"><link rel="prefetch" href="/assets/springcloud-hystrix.html-Bbo3WYBV.js" as="script"><link rel="prefetch" href="/assets/springcloud-ribbon.html-Qz587Edw.js" as="script"><link rel="prefetch" href="/assets/springcloud-select.html-Wq8arF4g.js" as="script"><link rel="prefetch" href="/assets/springcloud-zuul.html-B3VBFgTc.js" as="script"><link rel="prefetch" href="/assets/springmvc-annotation.html-CKG8-6He.js" as="script"><link rel="prefetch" href="/assets/springmvc-framework.html-CGjqdy1E.js" as="script"><link rel="prefetch" href="/assets/springmvc-work.html-Bw2Ys_LW.js" as="script"><link rel="prefetch" href="/assets/ShardingSphere-framework.html-DGjj2iwr.js" as="script"><link rel="prefetch" href="/assets/zookeeper-framework.html-DfXyfA2o.js" as="script"><link rel="prefetch" href="/assets/index.html-DZaIo1AS.js" as="script"><link rel="prefetch" href="/assets/baz.html-DQmaGHWg.js" as="script"><link rel="prefetch" href="/assets/index.html-Da82GWsU.js" as="script"><link rel="prefetch" href="/assets/ray.html-DfviJf3t.js" as="script"><link rel="prefetch" href="/assets/kafka-framework.html-DZgMnVf1.js" as="script"><link rel="prefetch" href="/assets/kafka-message.html-BoTprPi8.js" as="script"><link rel="prefetch" href="/assets/kafka-select.html-CQSYNLbk.js" as="script"><link rel="prefetch" href="/assets/rabbitmq-framework.html-vZ0l7fbX.js" as="script"><link rel="prefetch" href="/assets/Arthas.html-DYk-8wia.js" as="script"><link rel="prefetch" href="/assets/CodeReview.html-SWo1aLQA.js" as="script"><link rel="prefetch" href="/assets/GuavaCache.html-BJMIuKSA.js" as="script"><link rel="prefetch" href="/assets/JUnit.html-CXiHkP0i.js" as="script"><link rel="prefetch" href="/assets/Mermaid.html-qecy26mY.js" as="script"><link rel="prefetch" href="/assets/caffeine.html-CUO7jAr5.js" as="script"><link rel="prefetch" href="/assets/cursor-ide.html-CjjN9T1r.js" as="script"><link rel="prefetch" href="/assets/git.html-DxbHXRF4.js" as="script"><link rel="prefetch" href="/assets/intellij-idea.html-BroHR9Sw.js" as="script"><link rel="prefetch" href="/assets/linux.html-C6F8uPCJ.js" as="script"><link rel="prefetch" href="/assets/markdown.html-DSv3zr1p.js" as="script"><link rel="prefetch" href="/assets/maven.html-DtXzZ_-_.js" as="script"><link rel="prefetch" href="/assets/mysql.html-NJ5dFIZd.js" as="script"><link rel="prefetch" href="/assets/nginx.html-BQ6F0L_w.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-transaction.html-DsGQFS86.js" as="script"><link rel="prefetch" href="/assets/rocketmq-framwork.html-Bq8HkVLO.js" as="script"><link rel="prefetch" href="/assets/404.html-i5wRVx2E.js" as="script"><link rel="prefetch" href="/assets/index.html-deJJUcRN.js" as="script"><link rel="prefetch" href="/assets/index.html-DmUQDtmJ.js" as="script"><link rel="prefetch" href="/assets/index.html-CijXRMr8.js" as="script"><link rel="prefetch" href="/assets/index.html-CanJWV9d.js" as="script"><link rel="prefetch" href="/assets/index.html-gQ-uwfYm.js" as="script"><link rel="prefetch" href="/assets/index.html-zkEN2Ze7.js" as="script"><link rel="prefetch" href="/assets/index.html-BqXThkTM.js" as="script"><link rel="prefetch" href="/assets/index.html-acj8hkv1.js" as="script"><link rel="prefetch" href="/assets/index.html-C15mgqEy.js" as="script"><link rel="prefetch" href="/assets/index.html-C1Vbl2e5.js" as="script"><link rel="prefetch" href="/assets/index.html-B3rGRTEl.js" as="script"><link rel="prefetch" href="/assets/index.html-SEYtqnQF.js" as="script"><link rel="prefetch" href="/assets/index.html-BBGcF600.js" as="script"><link rel="prefetch" href="/assets/index.html-DgSSd7gc.js" as="script"><link rel="prefetch" href="/assets/index.html-Dlbqx9lv.js" as="script"><link rel="prefetch" href="/assets/index.html-DJkMXetk.js" as="script"><link rel="prefetch" href="/assets/index.html-BTer9ihw.js" as="script"><link rel="prefetch" href="/assets/index.html-BhxkG8NR.js" as="script"><link rel="prefetch" href="/assets/index.html-AX_aciMo.js" as="script"><link rel="prefetch" href="/assets/index.html-DwjVm7G1.js" as="script"><link rel="prefetch" href="/assets/index.html-DmUalmU3.js" as="script"><link rel="prefetch" href="/assets/index.html-DB3qu4Q_.js" as="script"><link rel="prefetch" href="/assets/index.html-T1c9wlZT.js" as="script"><link rel="prefetch" href="/assets/index.html-GH2gS8k7.js" as="script"><link rel="prefetch" href="/assets/index.html-CcsM-GZ8.js" as="script"><link rel="prefetch" href="/assets/index.html-DZ6Xpu7C.js" as="script"><link rel="prefetch" href="/assets/index.html-Y-Xw25M4.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz9C5UDK.js" as="script"><link rel="prefetch" href="/assets/index.html-IAFcTOiU.js" as="script"><link rel="prefetch" href="/assets/giscus-1zs_z9NH.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-CHJX-6eX.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Java八股文网</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="首页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>首页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/home.html" aria-label="Java八股文"><span class="font-icon icon fa-fw fa-sm fas fa-eight" style=""></span>Java八股文<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/algo/" aria-label="算法"><span class="font-icon icon fa-fw fa-sm fas fa-algo" style=""></span>算法<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/tool/" aria-label="工具"><span class="font-icon icon fa-fw fa-sm fas fa-tool" style=""></span>工具<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/interview/" aria-label="面试流程"><span class="font-icon icon fa-fw fa-sm fas fa-interview" style=""></span>面试流程<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/eq/" aria-label="程序员情商课"><span class="font-icon icon fa-fw fa-sm fas fa-eq" style=""></span>程序员情商课<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/about/" aria-label="关于"><span class="font-icon icon fa-fw fa-sm fas fa-about" style=""></span>关于<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/home.html" aria-label="一、前言"><!---->一、前言<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">二、Java基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">三、Java进阶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">四、数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">五、JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">六、框架</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">SpringBoot</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">SpringMVC</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">SpringCloud</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Netty</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ShardingSphere</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">mybatis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">nacos</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">pulsar</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">grpc</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">disruptor</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">elasticsearch</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ddd</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">seata</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/seata/seata-framework.html" aria-label="Seata架构设计"><!---->Seata架构设计<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">七、消息队列</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!----></h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-05-02T16:02:07.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 17 分钟</span><meta property="timeRequired" content="PT17M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<!----><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#深度解析seata-微服务分布式事务的破局之道">深度解析Seata：微服务分布式事务的破局之道</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-分布式事务-痛点何在">1. 分布式事务：痛点何在？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-理论基石-从acid到base">2. 理论基石：从ACID到BASE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-seata框架总览-三大核心组件tc-tm-rm">3. Seata框架总览：三大核心组件TC, TM, RM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-seata事务模式深度解析-条条大路通-一致">4. Seata事务模式深度解析：条条大路通“一致”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-seata的实现细节与进阶">5. Seata的实现细节与进阶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-常见问题与面试要点梳理">6. 常见问题与面试要点梳理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-总结与展望">7. 总结与展望</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="深度解析seata-微服务分布式事务的破局之道" tabindex="-1"><a class="header-anchor" href="#深度解析seata-微服务分布式事务的破局之道"><span>深度解析Seata：微服务分布式事务的破局之道</span></a></h2><p>随着微服务架构的广泛应用，业务系统被拆分成更小、独立的单元，它们各自拥有自己的数据库。这带来了巨大的灵活性和可伸缩性，但也引入了一个棘手的难题：<strong>分布式事务</strong>。当一个业务操作需要跨越多个服务、访问多个数据库时，如何保证这些操作的原子性（要么全部成功，要么全部失败）？这就是分布式事务需要解决的核心问题。</p><h3 id="_1-分布式事务-痛点何在" tabindex="-1"><a class="header-anchor" href="#_1-分布式事务-痛点何在"><span>1. 分布式事务：痛点何在？</span></a></h3><p>在单体应用时代，我们依赖数据库提供的本地事务（ACID特性）来保证数据的一致性。<code>@Transactional</code> 注解几乎可以解决所有问题。但进入分布式世界，情况完全不同了。</p><p>想象一下，一个用户下单的操作，可能涉及扣减库存服务、生成订单服务、调用支付服务，这三个服务可能分别对应不同的数据库。如果库存扣减成功，订单生成成功，但支付失败了，我们能简单地回滚前面两个操作吗？在本地事务中可以，但在分布式环境中，已经提交的本地事务是无法直接回滚的。这就是分布式事务的“跨越山河大海”的挑战。</p><p>传统的分布式事务解决方案，比如基于数据库的XA规范（二阶段提交），在单体应用或少量系统集成时尚可接受。但在微服务场景下，XA模式会长时间锁定资源，性能低下，且参与者（各个服务）需要强耦合，任何一个参与者的阻塞都可能导致整个事务挂起，与微服务的“松耦合”理念格格不入。</p><p>因此，我们需要一种新的方式来管理跨服务的业务一致性，这就是分布式事务框架的用武之地，Seata（Simple Extensible Autonomous Transaction Architecture）正是为此而生。</p><h3 id="_2-理论基石-从acid到base" tabindex="-1"><a class="header-anchor" href="#_2-理论基石-从acid到base"><span>2. 理论基石：从ACID到BASE</span></a></h3><p>在探讨Seata的具体实现之前，我们有必要快速回顾一下分布式系统的一致性理论。</p><ul><li><strong>ACID</strong>: 是传统数据库事务的四大特性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。它追求的是<strong>强一致性</strong>。在分布式系统中，特别是在出现网络分区（P）时，根据CAP定理，我们不得不权衡可用性（A）和一致性（C）。鱼与熊掌不可兼得，很难同时满足强一致性（C）和高可用性（A）。</li><li><strong>BASE</strong>: 是互联网分布式系统常用的设计思想：基本可用（Basically Available）、软状态（Soft State）、最终一致性（Eventually Consistent）。它追求的是<strong>最终一致性</strong>。BASE理论认为，系统在发生故障时允许出现短暂的不一致，但在故障恢复后，数据会逐渐达到一致状态。Seata的大部分模式，尤其是AT、TCC、SAGA，都是基于BASE理论，通过柔性事务来保证最终一致性。</li></ul><p>理解了从强一致性到最终一致性的转变，就理解了分布式事务解决方案（尤其是柔性事务）的设计哲学：牺牲短时的强一致性，换取系统的可用性和性能。</p><h3 id="_3-seata框架总览-三大核心组件tc-tm-rm" tabindex="-1"><a class="header-anchor" href="#_3-seata框架总览-三大核心组件tc-tm-rm"><span>3. Seata框架总览：三大核心组件<strong>TC, TM, RM</strong></span></a></h3><p>Seata框架本身也是一个分布式系统，它由三大核心组件构成，它们协同工作来管理分布式事务的生命周期：</p><p><em>(注：此处应为Seata架构概念图的文字描述)</em></p><ul><li><p><strong>Transaction Coordinator (TC) - 事务协调器:</strong></p><ul><li><strong>职责:</strong> 维护全局事务的状态，管理并驱动全局事务的提交或回滚。它是一个独立的的服务端应用。</li><li><strong>定位:</strong> 事务的“大脑”或“指挥中心”。它接收来自TM的全局事务请求，协调所有参与的RM。</li></ul></li><li><p><strong>Transaction Manager (TM) - 事务管理器:</strong></p><ul><li><strong>职责:</strong> 定义全局事务的范围。它负责向TC发起全局事务的开启（begin）、提交（commit）或回滚（rollback）请求。</li><li><strong>定位:</strong> 应用中发起分布式事务的“入口”。通常与业务代码集成在一起，例如通过Spring AOP或注解来实现。</li></ul></li><li><p><strong>Resource Manager (RM) - 资源管理器:</strong></p><ul><li><strong>职责:</strong> 管理分支事务处理的资源（例如数据库连接）。它负责向TC注册分支事务、汇报分支事务的状态，并接收TC的指令来提交或回滚分支事务。</li><li><strong>定位:</strong> 应用中访问具体资源的“代理”。以AT模式为例，RM会代理数据源，拦截SQL操作。</li></ul></li></ul><p><strong>它们如何协作？</strong></p><p>想象一下一次购物下单的分布式事务流程：</p><ol><li>用户在订单服务（TM所在）点击购买。</li><li>订单服务（TM）向TC发起一个<strong>全局事务</strong>开始的请求。TC生成一个唯一的全局事务ID（XID）。</li><li>订单服务（TM）开始执行业务逻辑： <ul><li>调用库存服务。库存服务（RM所在）在执行本地库存扣减前，向TC注册一个<strong>分支事务</strong>，并带上XID。RM执行库存扣减的本地事务，完成后向TC报告结果。</li><li>调用仓储服务。仓储服务（RM所在）在执行本地仓储操作前，向TC注册一个<strong>分支事务</strong>，并带上XID。RM执行仓储操作的本地事务，完成后向TC报告结果。</li></ul></li><li>订单服务（TM）所有业务逻辑执行完毕。</li><li>订单服务（TM）根据业务执行结果，向TC发起全局事务提交或回滚的请求。</li><li>TC收到请求，根据全局事务的状态以及所有分支事务的状态，决定全局事务的最终状态（提交或回滚）。</li><li>TC向所有参与过的RM发起分支事务的提交或回滚指令。</li><li>各个RM执行相应的分支提交或回滚操作，并向TC报告最终结果。</li><li>TC记录全局事务的最终状态。</li></ol><p>整个过程中，TC是中心协调者，TM是业务发起者，RM是资源执行者。</p><h3 id="_4-seata事务模式深度解析-条条大路通-一致" tabindex="-1"><a class="header-anchor" href="#_4-seata事务模式深度解析-条条大路通-一致"><span>4. Seata事务模式深度解析：条条大路通“一致”</span></a></h3><p>Seata提供了多种事务模式来应对不同的业务场景和技术栈，它们各有特点。这是面试中常被问到的重点！</p><h4 id="_4-1-at模式-automatic-transaction" tabindex="-1"><a class="header-anchor" href="#_4-1-at模式-automatic-transaction"><span>4.1 AT模式 (Automatic Transaction)</span></a></h4><p><strong>原理：</strong> 基于二阶段提交的改进，对业务代码<strong>无侵入</strong>（或极少侵入）。Seata通过拦截JDBC操作，自动完成事务协调。</p><p><strong>核心机制：</strong></p><ul><li><strong>数据源代理 (Data Source Proxy):</strong> Seata通过代理DataSource、Connection、Statement等JDBC对象，在业务SQL执行前后织入逻辑。这是AT模式“无侵入”的关键。</li><li><strong>Undo Log（回滚日志）:</strong> 这是AT模式的核心。在执行业务SQL（Update, Delete, Insert）之前，Data Source Proxy会解析SQL，查询数据的<strong>前镜像 (Before Image)</strong>；执行SQL后，查询数据的<strong>后镜像 (After Image)</strong>。前镜像和后镜像以及业务SQL等信息会组成一条<strong>Undo Log</strong>，记录在undo_log表中（每个RM对应的数据库都会有此表）。 <ul><li><strong>作用:</strong><ul><li><strong>全局提交时:</strong> 清理对应的Undo Log。</li><li><strong>全局回滚时:</strong> 根据Undo Log中的前镜像，生成补偿SQL，将数据恢复到业务操作之前的状态。</li></ul></li></ul></li><li><strong>全局锁 (Global Lock):</strong> 在AT模式的一阶段（业务提交本地事务），RM在向TC注册分支事务的同时，会尝试获取该分支事务所修改记录的<strong>全局锁</strong>。只有成功获取全局锁的分支才能继续。 <ul><li><strong>作用:</strong> 防止脏写。如果在全局事务提交前，另一个全局事务修改了同一行数据并提交，当前事务回滚时，就会覆盖掉后者已提交的数据，造成脏写。全局锁确保在一个全局事务提交或回滚前，其他全局事务不能提交对同一数据的修改。</li></ul></li></ul><p><strong>工作流程 (二阶段)：</strong></p><ul><li><strong>第一阶段 (业务提交 + 准备回滚):</strong><ol><li>TM向TC注册全局事务。</li><li>业务服务（RM）执行本地业务SQL。</li><li>Data Source Proxy拦截SQL，查询前镜像。</li><li>执行业务SQL，提交本地事务。</li><li>Data Source Proxy查询后镜像，与前镜像、业务SQL等组成Undo Log，记录到<code>undo_log</code>表。</li><li>RM向TC注册分支事务，并尝试获取全局锁。</li><li>RM向TC报告分支事务成功。</li></ol></li><li><strong>第二阶段 (全局提交 或 全局回滚):</strong><ul><li><strong>全局提交:</strong> TC收到TM提交请求，判断所有分支都成功后，向所有RM发送提交指令。RM收到提交指令，异步删除<code>undo_log</code>表中对应的记录即可。</li><li><strong>全局回滚:</strong> TC收到TM回滚请求（或有分支失败），向所有RM发送回滚指令。RM收到回滚指令，根据<code>undo_log</code>中的前镜像生成补偿SQL，执行补偿，将数据恢复到修改前的状态，并异步删除<code>undo_log</code>。</li></ul></li></ul><p><strong>优缺点:</strong></p><ul><li><strong>优点:</strong> 对业务代码侵入性小，几乎是透明的；提供 ACID 特性中 C 和 I 的保证（在 AT 模式下，通过全局锁和 Undo Log，虽然不是强一致，但可以防止脏写，提供了一种隔离性）；适用于关系型数据库。</li><li><strong>缺点:</strong> 依赖底层数据库支持本地事务；性能受Undo Log记录和全局锁开销影响；对非关系型数据库或跨数据库类型不适用。</li></ul><p><strong>适用场景:</strong> 主要用于关系型数据库之间的分布式事务，对业务代码改动要求低。</p><h4 id="_4-2-tcc模式-try-confirm-cancel" tabindex="-1"><a class="header-anchor" href="#_4-2-tcc模式-try-confirm-cancel"><span>4.2 TCC模式 (Try-Confirm-Cancel)</span></a></h4><p><strong>原理：</strong> 基于补偿机制的柔性事务。需要业务代码手动实现三个阶段：Try、Confirm、Cancel。</p><p><strong>核心机制：</strong></p><ul><li><strong>Try:</strong> 尝试执行业务操作，主要进行<strong>资源预留</strong>或<strong>业务检查</strong>。这个阶段必须保证业务数据的一致性（比如账户余额是否充足）。</li><li><strong>Confirm:</strong> 确认执行业务操作。Try阶段预留的资源在这里真正被消耗或锁定。Confirm操作必须是<strong>幂等</strong>的。</li><li><strong>Cancel:</strong> 取消执行业务操作。当Try阶段失败或全局事务需要回滚时，调用Cancel操作来<strong>释放</strong>Try阶段预留的资源。Cancel操作也必须是<strong>幂等</strong>的。</li></ul><p><strong>工作流程 (二阶段):</strong></p><ul><li><strong>第一阶段 (Try):</strong><ol><li>TM向TC注册全局事务。</li><li>TM调用各个参与者的Try方法。</li><li>各个参与者执行Try逻辑（预留/检查资源），并向TC报告结果。</li></ol></li><li><strong>第二阶段 (Confirm 或 Cancel):</strong><ul><li><strong>Confirm:</strong> 如果所有参与者的Try都成功，TC向所有参与者发送Confirm指令。各参与者执行Confirm逻辑。</li><li><strong>Cancel:</strong> 如果有任何一个参与者的Try失败，TC向所有<strong>已成功执行Try</strong>的参与者发送Cancel指令。各参与者执行Cancel逻辑。</li></ul></li></ul><p><strong>优缺点:</strong></p><ul><li><strong>优点:</strong> 灵活性高，可以支持各种异构资源（数据库、消息队列、外部服务等）；可以提供比AT更高的一致性级别（取决于Try阶段对资源的锁定程度）。</li><li><strong>缺点:</strong> 对业务代码侵入性高，需要为每个分布式事务涉及的操作手动编写Try、Confirm、Cancel三个方法；实现复杂，需要仔细处理幂等性和悬挂（Cancel先于Try执行）等问题。</li></ul><p><strong>适用场景:</strong> 适用于跨越多类型资源、业务流程复杂、对一致性要求较高的场景，但需要投入较高的开发成本。</p><h4 id="_4-3-saga模式" tabindex="-1"><a class="header-anchor" href="#_4-3-saga模式"><span>4.3 SAGA模式</span></a></h4><p><strong>原理：</strong> 长时运行事务解决方案，通过<strong>补偿操作链</strong>来实现。适用于业务流程非常长、跨越服务多的场景。</p><p><strong>核心机制：</strong></p><ul><li><strong>业务操作与补偿操作:</strong> SAGA模式将分布式事务分解为一系列的<strong>本地事务</strong>。每个本地事务都有一个与之对应的<strong>补偿操作</strong>。</li><li><strong>正向执行与逆向补偿:</strong> SAGA事务会按照预定的顺序执行这些本地事务。如果在执行过程中任何一个本地事务失败，则会按照相反的顺序调用已成功执行的本地事务的补偿操作，以抵消之前的操作。</li><li><strong>状态机/流程引擎:</strong> 通常需要一个状态机或流程引擎来驱动整个SAGA流程的执行和失败时的补偿。</li></ul><p><strong>工作流程:</strong></p><ol><li>TM向TC注册全局事务。</li><li>TC协调各个参与者，按顺序执行本地事务A。</li><li>如果A成功，执行本地事务B。</li><li>如果B成功，执行本地事务C...</li><li>如果在执行本地事务N时失败，则TC会协调，依次调用本地事务N-1的补偿操作，然后是N-2的补偿操作，直到已成功执行的第一个事务的补偿操作。</li></ol><p><strong>优缺点:</strong></p><ul><li><strong>优点:</strong> 适用于长流程、涉及服务多的场景；对性能影响相对较小（没有全局锁或长时间资源锁定）。</li><li><strong>缺点:</strong> 只保证最终一致性；补偿操作的编写和维护成本较高；设计复杂的补偿逻辑来处理各种失败场景。</li></ul><p><strong>适用场景:</strong> 业务流程长、需要跨越大量服务且允许最终一致性的场景，如复杂的审批流程、订单履约流程等。</p><h4 id="_4-4-xa模式" tabindex="-1"><a class="header-anchor" href="#_4-4-xa模式"><span>4.4 XA模式</span></a></h4><p><strong>原理：</strong> 实现了标准的XA协议，基于底层数据库的二阶段提交能力。</p><p><strong>核心机制：</strong> Seata作为协调者（充当TM和TC的角色），驱动各个支持XA协议的数据库执行Prepare、Commit/Rollback指令。</p><p><strong>工作流程:</strong> 标准的XA二阶段提交流程（Prepare -&gt; Commit/Rollback）。</p><p><strong>优缺点:</strong></p><ul><li><strong>优点:</strong> 保证强一致性（ACID）；原理简单，符合传统事务习惯。</li><li><strong>缺点:</strong> 性能差，长时间锁定数据库资源；对底层数据库有XA支持要求；不适用于非关系型数据库或跨异构资源；协调者宕机可能导致数据不一致（需复杂恢复机制）。</li></ul><p><strong>适用场景:</strong> 在微服务中较少使用，主要用于少量服务间且底层数据库强一致性要求极高、性能要求不敏感的场景。</p><h4 id="_4-5-各模式对比总结" tabindex="-1"><a class="header-anchor" href="#_4-5-各模式对比总结"><span>4.5 各模式对比总结</span></a></h4><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">AT模式</th><th style="text-align:left;">TCC模式</th><th style="text-align:left;">SAGA模式</th><th style="text-align:left;">XA模式</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>侵入性</strong></td><td style="text-align:left;">低（数据源代理）</td><td style="text-align:left;">高（业务代码需实现 Try/Confirm/Cancel）</td><td style="text-align:left;">高（业务代码需实现补偿逻辑）</td><td style="text-align:left;">低（依赖底层数据库XA支持）</td></tr><tr><td style="text-align:left;"><strong>一致性</strong></td><td style="text-align:left;">最终一致性（通过补偿）</td><td style="text-align:left;">最终一致性（通过补偿），可达强一致性（取决于Try锁定）</td><td style="text-align:left;">最终一致性（通过补偿）</td><td style="text-align:left;">强一致性</td></tr><tr><td style="text-align:left;"><strong>性能</strong></td><td style="text-align:left;">中（有Undo Log和全局锁开销）</td><td style="text-align:left;">高（业务实现决定）</td><td style="text-align:left;">高（业务实现决定，无资源长时间锁定）</td><td style="text-align:left;">低（长时间资源锁定）</td></tr><tr><td style="text-align:left;"><strong>复杂度</strong></td><td style="text-align:left;">低（框架自动处理）</td><td style="text-align:left;">高（需手动编写三阶段逻辑）</td><td style="text-align:left;">高（需设计补偿逻辑和流程）</td><td style="text-align:left;">低（依赖数据库）</td></tr><tr><td style="text-align:left;"><strong>适用资源</strong></td><td style="text-align:left;">关系型数据库</td><td style="text-align:left;">异构资源（DB,MQ,Service等）</td><td style="text-align:left;">异构资源（DB,MQ,Service等）</td><td style="text-align:left;">支持XA协议的关系型数据库</td></tr></tbody></table><p><strong>面试常考点:</strong> 当被问到“Seata有几种模式？如何选择？”时，除了列举模式名称，更重要的是要能结合场景说明它们的优缺点和选择依据。AT模式因其低侵入性在关系型数据库微服务中应用最广；TCC和SAGA则用于AT无法覆盖的复杂或异构场景。</p><h3 id="_5-seata的实现细节与进阶" tabindex="-1"><a class="header-anchor" href="#_5-seata的实现细节与进阶"><span>5. Seata的实现细节与进阶</span></a></h3><p>理解Seata的工作原理，还需要更深入地了解一些实现细节：</p><ul><li><strong>Data Source Proxy (数据源代理):</strong> 它的底层是基于Java的动态代理或字节码增强技术（如AspectJ），在运行时对DataSource对象进行包装。当应用代码通过代理对象执行SQL时，代理逻辑会被触发，从而进行Undo Log的记录和全局锁的获取。</li><li><strong>Undo Log 的存储:</strong> Undo Log默认存储在业务数据库的<code>undo_log</code>表中。这种方式简单方便，但也增加了业务数据库的负担。Seata也支持将Undo Log存储到文件或其他存储介质。</li><li><strong>全局锁的实现:</strong> 全局锁由TC统一管理。RM在向TC报告分支成功时，会携带其锁定的资源信息。TC会将这些锁信息存储起来，并在第二阶段全局提交时释放，全局回滚时校验锁是否存在。</li><li><strong>事务恢复 (Transaction Recovery):</strong> 分布式系统面临宕机和网络异常。Seata通过持久化事务状态来保证恢复能力。TC会将全局事务的状态持久化（到数据库或文件），RM会将分支事务状态和Undo Log持久化。当TC或RM宕机重启后，可以根据持久化的状态继续未完成的事务流程（提交或回滚），确保最终一致性。</li><li><strong>配置管理与集成:</strong> 在实际应用中，Seata的TC地址、注册中心、配置中心、事务分组等信息需要配置。通常通过Spring Cloud、Dubbo的集成组件来简化配置，例如使用 <code>@GlobalTransactional</code> 注解标记全局事务的入口。</li></ul><h3 id="_6-常见问题与面试要点梳理" tabindex="-1"><a class="header-anchor" href="#_6-常见问题与面试要点梳理"><span>6. 常见问题与面试要点梳理</span></a></h3><ul><li><strong>AT模式的性能问题:</strong> Undo Log的生成和全局锁的竞争会带来一定性能开销。可以通过优化SQL、减少全局事务跨度、合理设置全局锁超时时间等方式缓解。</li><li><strong>TCC模式的幂等性与悬挂:</strong><ul><li><strong>幂等性:</strong> Try、Confirm、Cancel方法必须是幂等的，即多次调用产生的结果一致。需要在业务代码中加入幂等判断逻辑（如使用业务ID去重）。</li><li><strong>悬挂:</strong> Cancel调用先于Try调用发生。例如，TC重试Cancel指令时，Try请求因为网络延迟才到达。需要在Try方法中判断全局事务状态，如果已被判定为Cancel，则Try直接返回失败或空操作。</li></ul></li><li><strong>SAGA模式的补偿逻辑复杂性:</strong> SAGA模式的难点在于设计完善的补偿逻辑，要覆盖所有可能的失败组合，确保补偿操作本身不会失败。</li><li><strong>TC的可用性:</strong> TC是Seata的核心协调者，其可用性至关重要。生产环境中TC通常以集群方式部署，并依赖注册中心进行服务发现。</li><li><strong>面试题集锦（划重点！）：</strong><ul><li>微服务下为什么需要分布式事务？本地事务和XA为什么不适用？</li><li>Seata的整体架构是什么？TC、TM、RM分别负责什么？它们如何交互？</li><li>详细解释Seata的AT模式原理，Undo Log和全局锁的作用是什么？（高频题）</li><li>TCC模式如何工作？Try、Confirm、Cancel分别做什么？如何保证幂等性和解决悬挂问题？（高频题）</li><li>SAGA模式适用于什么场景？它的基本思想是什么？</li><li>AT、TCC、SAGA、XA这几种模式有什么区别？如何根据业务场景选择合适的模式？（高频题）</li><li>Seata如何保证事务的最终一致性？如何处理TC或RM宕机的情况？</li></ul></li></ul><h3 id="_7-总结与展望" tabindex="-1"><a class="header-anchor" href="#_7-总结与展望"><span>7. 总结与展望</span></a></h3><p>Seata作为一套成熟的分布式事务框架，为微服务架构下的数据一致性提供了有效的解决方案。它提供了多种事务模式，通过灵活的选择，可以适应不同业务场景的技术需求。尤其是其AT模式，凭借对业务代码的低侵入性，极大地降低了分布式事务的实施门槛，是关系型数据库场景下的首选。</p><p>当然，分布式事务本身就是一个复杂的课题，Seata也并非银弹。在使用过程中，我们需要深入理解其原理，结合业务场景仔细权衡，并关注其在高并发、故障恢复等方面的表现。</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/seata/seata-framework.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: oointer@163.com">Yideng</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2026 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BwInYlua.js" defer></script>
  </body>
</html>
